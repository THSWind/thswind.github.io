{"title":"Algorithm: SumTree practice","date":"2019-11-08T05:00:36.000Z","date_formatted":{"ll":"Nov 8, 2019","L":"11/08/2019","MM-DD":"11-08"},"link":"undefined/Sumtree algorithm exercise","comments":true,"tags":["ALG","RL"],"updated":"2019-11-08T05:00:36.000Z","content":"<h2 id=\"代码\">代码<a title=\"#代码\" href=\"#代码\"></a></h2>\n<p>代码来源于网络，我主要对这段代码进行了解读。并对代码最后6行用于测试的例子的代码计算过程做了详细的梳理。</p>\n<p><code>import numpy as np</code></p>\n<p><code>class Tree(object):</code><br>\n<code>write = 0</code>  # 表示第几个叶子节点可用（未被写入数据或可覆盖原数据）<br>\n<code>def __init__(self, capacity):</code><br>\n<code>self.capacity = capacity  # capacity是叶子节点个数，</code><br>\n<code>self.tree = np.zeros(2 * capacity)  # 从1开始编号[1,capacity]</code><br>\n<code>self.data = np.zeros(capacity+1, dtype=object)  # 存叶子节点对应的数据data[叶子节点编号id] = data</code></p>\n<pre><code>def add(self, p, data):\n    idx = self.write + self.capacity  \n    self.data[self.write+1] = data\n    self._updatetree(idx, p)\n    self.write += 1\n    if self.write &gt; self.capacity:  \n        self.write = 0\n \ndef _updatetree(self, idx, p):\n    change = p - self.tree[idx]  \n    self._propagate(idx, change)  \n    self.tree[idx] = p  \n \ndef _propagate(self, idx, change):\n    parent = idx // 2  \n    self.tree[parent] += change  # 更新父节点的值，是向上传播的体现\n    if parent != 1:\n        self._propagate(parent, change)  \n \ndef _total(self):\n    return self.tree[1]  \n \ndef get(self, s):\n    idx = self._retrieve(1, s)  \n    index_data = idx - self.capacity + 1  \n    return (idx, self.tree[idx], self.data[index_data])\n \ndef _retrieve(self, idx, s):\n    left = 2 * idx  \n    right = left + 1\n    if left &gt;= (len(self.tree)-1):  \n        return idx\n    if s &lt;= self.tree[left]:\n        return self._retrieve(left, s)  # 往左孩子处查找\n    else:\n        return self._retrieve(right, s - self.tree[left])  # 往右孩子处查找\n</code></pre>\n<p><code>tree = Tree(5)</code><br>\n<code>tree.add(1,3)</code><br>\n<code>tree.add(2,4)</code><br>\n<code>tree.add(3,5)</code><br>\n<code>tree.add(4,6)</code><br>\n<code>tree.add(6,11)</code></p>\n<p><code>print(tree.get(4))  # (8, 4.0, 6)</code></p>\n<h1 id=\"我对末尾六行代码及其结果计算过程梳理\">我对末尾六行代码及其结果计算过程梳理<a title=\"#我对末尾六行代码及其结果计算过程梳理\" href=\"#我对末尾六行代码及其结果计算过程梳理\"></a></h1>\n<p>初始化条件（class中已给出）：write=0</p>\n<p>tree = Tree(5) =&gt;capacity=5</p>\n<p><img src=\"https://i.loli.net/2019/11/08/yFIeRf19r3ct7Lq.png\" alt=\"image.png\" loading=\"lazy\" class=\"φbp\"></p>\n<p>data:</p>\n<p>[0,0,0,0,0,0]</p>\n<h2 id=\"step-1:-tree.add(1,3)\">step 1: tree.add(1,3)<a title=\"#step-1:-tree.add(1,3)\" href=\"#step-1:-tree.add(1,3)\"></a></h2>\n<p>p=1, data=3</p>\n<p>idx=write+capacity=5</p>\n<p>data[write+1]=data=3</p>\n<p>data:[0,3,0,0,0,0]</p>\n<p>updatetree(idx,p)</p>\n<ul>\n<li>\n<p>updatetree(5,1)</p>\n<p>change=p-tree[idx]=1-0=1</p>\n<p>propagate(idx,change)</p>\n<ul>\n<li>\n<p>propagate(5,1)</p>\n<p>parent=idx//2=2</p>\n<p>tree[parent]+=change</p>\n<p>tree[2]=1</p>\n<ul>\n<li>\n<p>tree</p>\n<pre><code>                     0                                                \n                   /   \\\n                  /     \\\n                 /       \\\n                /         \\\n               /           \\\n              /             \\\n             /               \\\n            /                 \\\n         1                      0                         \n       /   \\                   /   \\\n      /     \\                 /     \\\n     /       \\               /       \\\n    /         \\             /         \\\n   0           0            0           0          \n /   \\                 \n/     \\                \n0      0                \n</code></pre>\n</li>\n<li>\n<p>if parent !=1</p>\n<p>progpagate(parent, change)</p>\n<ul>\n<li>\n<p>propagate(2,1)</p>\n<p>parent=1</p>\n<p>tree[parent]=1</p>\n<pre><code>                         1                                                \n                       /   \\\n                      /     \\\n                     /       \\\n                    /         \\\n                   /           \\\n                  /             \\\n                 /               \\\n                /                 \\\n             1                      0                         \n           /   \\                   /   \\\n          /     \\                 /     \\\n         /       \\               /       \\\n        /         \\             /         \\\n        0          0           0           0          \n      /   \\                 \n     /     \\                \n    0       0 \n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p>tree[idx]=p</p>\n<pre><code>                     1                                                \n                   /   \\\n                  /     \\\n                 /       \\\n                /         \\\n               /           \\\n              /             \\\n             /               \\\n            /                 \\\n         1                      0                         \n       /   \\                   /   \\\n      /     \\                 /     \\\n     /       \\               /       \\\n    /         \\             /         \\\n    0          1           0           0          \n  /   \\                 \n /     \\                \n0       0 \n</code></pre>\n</li>\n</ul>\n<p>write=1</p>\n<h2 id=\"step-2:-tree.add(2,4)\">step 2: tree.add(2,4)<a title=\"#step-2:-tree.add(2,4)\" href=\"#step-2:-tree.add(2,4)\"></a></h2>\n<p>p=2, data=4</p>\n<p>idx=write+capacity=6</p>\n<p>data[write+1]=data=4</p>\n<p>data:[0,3,4,0,0,0]</p>\n<p>updatetree(idx,p)</p>\n<ul>\n<li>\n<p>updatetree(6,2)</p>\n<p>change=p-tree[idx]=2-0=2</p>\n<p>propagate(idx,change)</p>\n<ul>\n<li>\n<p>propagate(6,2)</p>\n<p>parent=idx//2=3</p>\n<p>tree[parent]+=change</p>\n<p>tree[3]=2</p>\n<ul>\n<li>\n<p>tree</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                     1                                                </span><br><span class=\"line\">                   /   \\</span><br><span class=\"line\">                  /     \\</span><br><span class=\"line\">                 /       \\</span><br><span class=\"line\">                /         \\</span><br><span class=\"line\">               /           \\</span><br><span class=\"line\">              /             \\</span><br><span class=\"line\">             /               \\</span><br><span class=\"line\">            /                 \\</span><br><span class=\"line\">         1                      2                         </span><br><span class=\"line\">       /   \\                   /   \\</span><br><span class=\"line\">      /     \\                 /     \\</span><br><span class=\"line\">     /       \\               /       \\</span><br><span class=\"line\">    /         \\             /         \\</span><br><span class=\"line\">   0           1            0           0          </span><br><span class=\"line\"> /   \\                 </span><br><span class=\"line\">/     \\                </span><br><span class=\"line\">0      0                </span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>if parent !=1</p>\n<p>progpagate(parent, change)</p>\n<ul>\n<li>\n<p>propagate(3,2)</p>\n<p>parent=1</p>\n<p>tree[parent]=3</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                     3                                                </span><br><span class=\"line\">                   /   \\</span><br><span class=\"line\">                  /     \\</span><br><span class=\"line\">                 /       \\</span><br><span class=\"line\">                /         \\</span><br><span class=\"line\">               /           \\</span><br><span class=\"line\">              /             \\</span><br><span class=\"line\">             /               \\</span><br><span class=\"line\">            /                 \\</span><br><span class=\"line\">         1                      2                         </span><br><span class=\"line\">       /   \\                   /   \\</span><br><span class=\"line\">      /     \\                 /     \\</span><br><span class=\"line\">     /       \\               /       \\</span><br><span class=\"line\">    /         \\             /         \\</span><br><span class=\"line\">    0          1           0           0          </span><br><span class=\"line\">  /   \\                 </span><br><span class=\"line\"> /     \\                </span><br><span class=\"line\">0       0 </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p>tree[idx]=p=2</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                     3                                                </span><br><span class=\"line\">                   /   \\</span><br><span class=\"line\">                  /     \\</span><br><span class=\"line\">                 /       \\</span><br><span class=\"line\">                /         \\</span><br><span class=\"line\">               /           \\</span><br><span class=\"line\">              /             \\</span><br><span class=\"line\">             /               \\</span><br><span class=\"line\">            /                 \\</span><br><span class=\"line\">         1                      2                         </span><br><span class=\"line\">       /   \\                   /   \\</span><br><span class=\"line\">      /     \\                 /     \\</span><br><span class=\"line\">     /       \\               /       \\</span><br><span class=\"line\">    /         \\             /         \\</span><br><span class=\"line\">    0          1           2           0          </span><br><span class=\"line\">  /   \\                 </span><br><span class=\"line\"> /     \\                </span><br><span class=\"line\">0       0 </span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>write=2</p>\n<h2 id=\"step-3:-tree.add(3,5)\">step 3: tree.add(3,5)<a title=\"#step-3:-tree.add(3,5)\" href=\"#step-3:-tree.add(3,5)\"></a></h2>\n<p>p=3, data=5</p>\n<p>idx=write+capacity=7</p>\n<p>data[write+1]=data=5</p>\n<p>data:[0,3,4,5,0,0]</p>\n<p>updatetree(idx,p)</p>\n<ul>\n<li>\n<p>updatetree(7,3)</p>\n<p>change=p-tree[idx]=3-0=3</p>\n<p>propagate(idx,change)</p>\n<ul>\n<li>\n<p>propagate(7,3)</p>\n<p>parent=idx//2=3</p>\n<p>tree[parent]+=change</p>\n<p>tree[3]=5</p>\n<ul>\n<li>\n<p>tree</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                     3                                                </span><br><span class=\"line\">                   /   \\</span><br><span class=\"line\">                  /     \\</span><br><span class=\"line\">                 /       \\</span><br><span class=\"line\">                /         \\</span><br><span class=\"line\">               /           \\</span><br><span class=\"line\">              /             \\</span><br><span class=\"line\">             /               \\</span><br><span class=\"line\">            /                 \\</span><br><span class=\"line\">         1                      5                         </span><br><span class=\"line\">       /   \\                   /   \\</span><br><span class=\"line\">      /     \\                 /     \\</span><br><span class=\"line\">     /       \\               /       \\</span><br><span class=\"line\">    /         \\             /         \\</span><br><span class=\"line\">   0           1           2           0          </span><br><span class=\"line\"> /   \\                 </span><br><span class=\"line\">/     \\                </span><br><span class=\"line\">0      0                </span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>if parent !=1</p>\n<p>progpagate(parent, change)</p>\n<ul>\n<li>\n<p>propagate(3,3)</p>\n<p>parent=1</p>\n<p>tree[parent]=6</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                     6                                                </span><br><span class=\"line\">                   /   \\</span><br><span class=\"line\">                  /     \\</span><br><span class=\"line\">                 /       \\</span><br><span class=\"line\">                /         \\</span><br><span class=\"line\">               /           \\</span><br><span class=\"line\">              /             \\</span><br><span class=\"line\">             /               \\</span><br><span class=\"line\">            /                 \\</span><br><span class=\"line\">         1                      5                         </span><br><span class=\"line\">       /   \\                   /   \\</span><br><span class=\"line\">      /     \\                 /     \\</span><br><span class=\"line\">     /       \\               /       \\</span><br><span class=\"line\">    /         \\             /         \\</span><br><span class=\"line\">    0          1           2           0          </span><br><span class=\"line\">  /   \\                 </span><br><span class=\"line\"> /     \\                </span><br><span class=\"line\">0       0 </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p>tree[idx]=p=3</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                     6                                                </span><br><span class=\"line\">                   /   \\</span><br><span class=\"line\">                  /     \\</span><br><span class=\"line\">                 /       \\</span><br><span class=\"line\">                /         \\</span><br><span class=\"line\">               /           \\</span><br><span class=\"line\">              /             \\</span><br><span class=\"line\">             /               \\</span><br><span class=\"line\">            /                 \\</span><br><span class=\"line\">         1                      5                         </span><br><span class=\"line\">       /   \\                   /   \\</span><br><span class=\"line\">      /     \\                 /     \\</span><br><span class=\"line\">     /       \\               /       \\</span><br><span class=\"line\">    /         \\             /         \\</span><br><span class=\"line\">    0          1           2           3          </span><br><span class=\"line\">  /   \\                 </span><br><span class=\"line\"> /     \\                </span><br><span class=\"line\">0       0 </span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>write=3</p>\n<h2 id=\"step-4:-tree.add(4,6)\">step 4: tree.add(4,6)<a title=\"#step-4:-tree.add(4,6)\" href=\"#step-4:-tree.add(4,6)\"></a></h2>\n<p>p=4, data=6</p>\n<p>idx=write+capacity=8</p>\n<p>data[write+1]=data=6</p>\n<p>data:[0,3,4,5,6,0]</p>\n<p>updatetree(idx,p)</p>\n<ul>\n<li>\n<p>updatetree(8,4)</p>\n<p>change=p-tree[idx]=4-0=4</p>\n<p>propagate(idx,change)</p>\n<ul>\n<li>\n<p>propagate(8,4)</p>\n<p>parent=idx//2=4</p>\n<p>tree[parent]+=change</p>\n<p>tree[4]=4</p>\n<ul>\n<li>\n<p>tree</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                     6                                                </span><br><span class=\"line\">                   /   \\</span><br><span class=\"line\">                  /     \\</span><br><span class=\"line\">                 /       \\</span><br><span class=\"line\">                /         \\</span><br><span class=\"line\">               /           \\</span><br><span class=\"line\">              /             \\</span><br><span class=\"line\">             /               \\</span><br><span class=\"line\">            /                 \\</span><br><span class=\"line\">         1                      5                         </span><br><span class=\"line\">       /   \\                   /   \\</span><br><span class=\"line\">      /     \\                 /     \\</span><br><span class=\"line\">     /       \\               /       \\</span><br><span class=\"line\">    /         \\             /         \\</span><br><span class=\"line\">   4           1           2           3          </span><br><span class=\"line\"> /   \\                 </span><br><span class=\"line\">/     \\                </span><br><span class=\"line\">0      0                </span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>if parent !=1</p>\n<p>propagate(parent, change)</p>\n<ul>\n<li>\n<p>propagate(4,4)</p>\n<p>parent=2</p>\n<p>tree[parent]=5</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                     6                                                </span><br><span class=\"line\">                   /   \\</span><br><span class=\"line\">                  /     \\</span><br><span class=\"line\">                 /       \\</span><br><span class=\"line\">                /         \\</span><br><span class=\"line\">               /           \\</span><br><span class=\"line\">              /             \\</span><br><span class=\"line\">             /               \\</span><br><span class=\"line\">            /                 \\</span><br><span class=\"line\">         5                      5                         </span><br><span class=\"line\">       /   \\                   /   \\</span><br><span class=\"line\">      /     \\                 /     \\</span><br><span class=\"line\">     /       \\               /       \\</span><br><span class=\"line\">    /         \\             /         \\</span><br><span class=\"line\">   4           1           2           3          </span><br><span class=\"line\">  /   \\                 </span><br><span class=\"line\"> /     \\                </span><br><span class=\"line\">0       0 </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>if parent !=1</p>\n<p>propagate(parent,change)</p>\n<ul>\n<li>\n<p>propagate(2,4)</p>\n<p>parent=1</p>\n<p>tree[parent]=10</p>\n<pre><code>                     10                                                \n                   /   \\\n                  /     \\\n                 /       \\\n                /         \\\n               /           \\\n              /             \\\n             /               \\\n            /                 \\\n         5                      5                         \n       /   \\                   /   \\\n      /     \\                 /     \\\n     /       \\               /       \\\n    /         \\             /         \\\n   4           1           2           3          \n  /   \\                 \n /     \\                \n0       0 \n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p>tree[idx]=p=4</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                     10                                                </span><br><span class=\"line\">                   /   \\</span><br><span class=\"line\">                  /     \\</span><br><span class=\"line\">                 /       \\</span><br><span class=\"line\">                /         \\</span><br><span class=\"line\">               /           \\</span><br><span class=\"line\">              /             \\</span><br><span class=\"line\">             /               \\</span><br><span class=\"line\">            /                 \\</span><br><span class=\"line\">         5                      5                         </span><br><span class=\"line\">       /   \\                   /   \\</span><br><span class=\"line\">      /     \\                 /     \\</span><br><span class=\"line\">     /       \\               /       \\</span><br><span class=\"line\">    /         \\             /         \\</span><br><span class=\"line\">    4          1           2           3          </span><br><span class=\"line\">  /   \\                 </span><br><span class=\"line\"> /     \\                </span><br><span class=\"line\">4       0 </span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>write=4</p>\n<h2 id=\"step-5:-tree.add(6,11)\">step 5: tree.add(6,11)<a title=\"#step-5:-tree.add(6,11)\" href=\"#step-5:-tree.add(6,11)\"></a></h2>\n<p>p=6, data=11</p>\n<p>idx=write+capacity=9</p>\n<p>data[write+1]=data=11</p>\n<p>data:[0,3,4,5,6,11]</p>\n<p>updatetree(idx,p)</p>\n<ul>\n<li>\n<p>updatetree(9,6)</p>\n<p>change=p-tree[idx]=6-0=6</p>\n<p>propagate(idx,change)</p>\n<ul>\n<li>\n<p>propagate(9,6)</p>\n<p>parent=idx//2=4</p>\n<p>tree[parent]+=change</p>\n<p>tree[4]=10</p>\n<ul>\n<li>\n<p>tree</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                     10                                                </span><br><span class=\"line\">                   /   \\</span><br><span class=\"line\">                  /     \\</span><br><span class=\"line\">                 /       \\</span><br><span class=\"line\">                /         \\</span><br><span class=\"line\">               /           \\</span><br><span class=\"line\">              /             \\</span><br><span class=\"line\">             /               \\</span><br><span class=\"line\">            /                 \\</span><br><span class=\"line\">         5                      5                         </span><br><span class=\"line\">       /   \\                   /   \\</span><br><span class=\"line\">      /     \\                 /     \\</span><br><span class=\"line\">     /       \\               /       \\</span><br><span class=\"line\">    /         \\             /         \\</span><br><span class=\"line\">   10           1           2           3          </span><br><span class=\"line\"> /   \\                 </span><br><span class=\"line\">/     \\                </span><br><span class=\"line\">4      0                </span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>if parent !=1</p>\n<p>propagate(parent, change)</p>\n<ul>\n<li>\n<p>propagate(4,6)</p>\n<p>parent=2</p>\n<p>tree[parent]=11</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                     6                                                </span><br><span class=\"line\">                   /   \\</span><br><span class=\"line\">                  /     \\</span><br><span class=\"line\">                 /       \\</span><br><span class=\"line\">                /         \\</span><br><span class=\"line\">               /           \\</span><br><span class=\"line\">              /             \\</span><br><span class=\"line\">             /               \\</span><br><span class=\"line\">            /                 \\</span><br><span class=\"line\">         11                      5                         </span><br><span class=\"line\">       /   \\                   /   \\</span><br><span class=\"line\">      /     \\                 /     \\</span><br><span class=\"line\">     /       \\               /       \\</span><br><span class=\"line\">    /         \\             /         \\</span><br><span class=\"line\">   10           1           2           3          </span><br><span class=\"line\">  /   \\                 </span><br><span class=\"line\"> /     \\                </span><br><span class=\"line\">4       0 </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>if parent !=1</p>\n<p>propagate(parent,change)</p>\n<ul>\n<li>\n<p>propagate(2,6)</p>\n<p>parent=1</p>\n<p>tree[parent]=16</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                     16                                                </span><br><span class=\"line\">                   /   \\</span><br><span class=\"line\">                  /     \\</span><br><span class=\"line\">                 /       \\</span><br><span class=\"line\">                /         \\</span><br><span class=\"line\">               /           \\</span><br><span class=\"line\">              /             \\</span><br><span class=\"line\">             /               \\</span><br><span class=\"line\">            /                 \\</span><br><span class=\"line\">         11                     5                         </span><br><span class=\"line\">       /   \\                   /   \\</span><br><span class=\"line\">      /     \\                 /     \\</span><br><span class=\"line\">     /       \\               /       \\</span><br><span class=\"line\">    /         \\             /         \\</span><br><span class=\"line\">   10           1           2           3          </span><br><span class=\"line\">  /   \\                 </span><br><span class=\"line\"> /     \\                </span><br><span class=\"line\">4       0 </span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p>tree[idx]=p=6</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                     16                                                </span><br><span class=\"line\">                   /   \\</span><br><span class=\"line\">                  /     \\</span><br><span class=\"line\">                 /       \\</span><br><span class=\"line\">                /         \\</span><br><span class=\"line\">               /           \\</span><br><span class=\"line\">              /             \\</span><br><span class=\"line\">             /               \\</span><br><span class=\"line\">            /                 \\</span><br><span class=\"line\">         11                      5                         </span><br><span class=\"line\">       /   \\                   /   \\</span><br><span class=\"line\">      /     \\                 /     \\</span><br><span class=\"line\">     /       \\               /       \\</span><br><span class=\"line\">    /         \\             /         \\</span><br><span class=\"line\">   10          1           2           3          </span><br><span class=\"line\">  /   \\                 </span><br><span class=\"line\"> /     \\                </span><br><span class=\"line\">4       6 </span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>write=5</p>\n<h2 id=\"step-6:-print(tree.get(4))\">step 6: print(tree.get(4))<a title=\"#step-6:-print(tree.get(4))\" href=\"#step-6:-print(tree.get(4))\"></a></h2>\n<p>tree.get(4)=&gt;s=4</p>\n<p>idx=retrieve(1,s)</p>\n<ul>\n<li>\n<p>retrieve(1,4)</p>\n<p>idx=1,s=4</p>\n<p>left=2*idx=2</p>\n<p>right=3</p>\n<p>if left&gt;= 9:</p>\n<p>​\treturn idx</p>\n<p>if s&lt;=tree[left]:</p>\n<p>​\treturn retrieve(left,4)</p>\n<ul>\n<li>\n<p>retrieve(2,4)</p>\n<p>left=4 right=5</p>\n<p>if left&gt;=9:</p>\n<p>​\treturn idx</p>\n<p>if s&lt;=tree[left]=10</p>\n<p>​\treturn retrieve(left,4)</p>\n<ul>\n<li>\n<p>retrieve(4,4)</p>\n<p>left=8 right=9</p>\n<p>if left&gt;=9</p>\n<p>​\treturn idx</p>\n<p>if s&lt;=tree[left]</p>\n<p>​\tretrieve(left,4)</p>\n<ul>\n<li>\n<p>retrieve(8,4)</p>\n<p>left=16, right=17</p>\n<p>if left&gt;=9</p>\n<p>​\treturn idx</p>\n<p>​\tidx=8</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p>idx=8</p>\n<p>index_data=8-5+1=4</p>\n<p>此时data为：[0,3,4,5,6,11]</p>\n<p>return(idx, self.tree[idx], self.data[index_data])</p>\n<p>return(8,4.0,6)</p>\n<p>故输出为：</p>\n<p>8，4.0，6</p>\n<p>此次代码分析，到此结束。</p>\n","prev":{"title":"Ubuntu: double screen+settings","link":"undefined/Ubuntu+double screen+settings"},"next":{"title":"Parameter Space Noise For Exploration","link":"undefined/Parameter Space Noise For Exploration"},"plink":"http://thswind.github.io/undefined/Sumtree algorithm exercise/","toc":[{"id":"代码","title":"代码","index":"1"}],"reading_time":"1331 words in 9 min"}